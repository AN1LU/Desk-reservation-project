
<div class="profile-container">
  <a routerLink="/home" class="back-link">&larr; Volver a inicio</a>
  <!-- Title moved outside the grey card so it appears above the overlay -->
  <h2 class="profile-title">Bienvenido a tu perfil</h2>
	<div class="profile-card">

		<div *ngIf="loading">Cargando perfil...</div>
		<div *ngIf="!loading">
			<div class="profile-header">
				<img *ngIf="user?.user_metadata?.avatar_url" [src]="user.user_metadata.avatar_url" alt="avatar" class="profile-avatar" />
				<div class="profile-details">
					<div class="profile-row"><strong>Nombre:</strong> <span>{{ displayName }}</span></div>
					<div class="profile-row"><strong>Email:</strong> <span>{{ user?.email }}</span></div>
					<div class="profile-row"><strong>Membresía:</strong> <span>{{ membership?.tipo_membresia || 'Sin membresía' }}</span></div>
					<div class="profile-row" *ngIf="membership?.fecha_fin"><strong>Vence:</strong> <span>{{ membership?.fecha_fin | date:'short' }}</span></div>
					<div class="profile-row" *ngIf="remainingReservations != null"><strong>Reservas restantes:</strong> <span>{{ remainingReservations }}</span></div>
				</div>
			</div>

			<div class="profile-row" style="margin-top:.5rem"><strong>Reservas actuales (total):</strong> <span>{{ reservations.length }}</span></div>
			<ul class="profile-list">
				<li class="reservation-item" *ngFor="let r of reservations">
					<div class="reservation-info">Espacio #{{ r.id_espacio }}</div>
					<div class="reservation-meta">{{ r.fecha_inicio | date:'short' }} — {{ r.fecha_fin | date:'short' }}</div>
					<div>
						<button class="btn cancel-btn" (click)="cancelReservation(r.id_reserva)" [disabled]="loading">Cancelar</button>
					</div>
				</li>
				<li *ngIf="reservations.length === 0">No tienes reservas.</li>
			</ul>
			<div class="infoMessage" *ngIf="infoMessage">{{ infoMessage }}</div>
		</div>
	</div>
</div>
